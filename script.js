async function loadQuotes(){try{let t=await fetch("quotes.txt"),e=await t.text(),i=e.split("\n").filter(t=>""!==t.trim()),a=i.map(t=>{let[e,i]=t.split(" - ");return{quote:e?.trim(),author:i?.trim()||"Unknown"}});return console.log(a),a}catch(n){console.error("Error loading quotes:",n)}}const myQuotes=loadQuotes(),DISCORD_USER_ID="1372459254136705064",CITY_NAME="catland";let activityCarouselInterval=null,activityUpdateInterval=null,wsHeartbeatInterval=null,quoteTimeout,audioPlayer=null,currentPlayingTrackDiv=null;function initMedia(){console.log("initMedia called");let t=document.getElementById("background");if(!t){console.error("Media elements not found");return}t.volume=.3,t.play().catch(t=>{console.warn("Initial video play attempt failed (expected if muted in HTML):",t)})}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("start-screen"),e=document.getElementById("start-text"),i=document.getElementById("profile-name"),a=document.getElementById("background"),n=document.getElementById("volume-icon"),s=document.getElementById("volume-slider");document.getElementById("transparency-slider");let o=document.querySelector(".glitch-overlay"),r=document.getElementById("profile-block"),l=document.querySelector(".profile-picture");function d(e){e.preventDefault(),t.classList.add("hidden"),a.muted=!1,a.play().catch(t=>console.error("Failed to play background video after user interaction:",t)),r.classList.remove("hidden"),gsap.fromTo(r,{opacity:0,y:-50},{opacity:1,y:0,duration:1,ease:"power2.out"}),f(),E()}t.addEventListener("click",d),t.addEventListener("touchstart",d);let c="Click here to wake up the pixels!",$="",p=0,u=!0;function _(){p<c.length&&($=c.slice(0,p+1),p++),e.textContent=$+(u?"|":" "),setTimeout(_,100)}setInterval(()=>{u=!u,e.textContent=$+(u?"|":" ")},500),_();let v="ellii",y="",m=0,h=!1,g=!0;function f(){if(!h&&m<v.length)y=v.slice(0,m+1),m++;else if(h&&m>0)y=v.slice(0,m-1),m--;else if(m===v.length){h=!0,setTimeout(f,1e4);return}else 0===m&&(h=!1);i.textContent=y+(g?"|":" "),.1>Math.random()&&(i.classList.add("glitch"),setTimeout(()=>i.classList.remove("glitch"),200)),setTimeout(f,h?150:300)}function w(t,e){let i=document.getElementById("profile-bio");if(!i)return;let a=0;i.textContent="|",!function n(){a<t.length?(i.textContent=t.slice(0,a+1)+"|",a++,setTimeout(n,35)):(i.textContent=t,e&&e())}()}function x(t){let e=document.getElementById("profile-bio");if(!e)return;let i=e.textContent,a=i.length;!function n(){a>0?(e.textContent=i.slice(0,a-1)+"|",a--,setTimeout(n,25)):(e.textContent="|",t&&t())}()}function b(){x(()=>{let t=Math.floor(Math.random()*myQuotes.length),e=myQuotes[t],i=`"${e.quote}" — ${e.author}`;w(i,()=>{quoteTimeout=setTimeout(b,4e3)})})}function E(){let t=document.getElementById("profile-bio");if(!t)return;let e=Math.floor(Math.random()*myQuotes.length),i=myQuotes[e],a=`"${i.quote}" — ${i.author}`;w(a,()=>{quoteTimeout=setTimeout(b,4e3)})}setInterval(()=>{g=!g,i.textContent=y+(g?"|":" ")},500);let I=a,k=!1;function C(t,e){let i=e.getBoundingClientRect(),a=i.left+i.width/2,n=i.top+i.height/2,s,o;"touchmove"===t.type?(s=t.touches[0].clientX,o=t.touches[0].clientY):(s=t.clientX,o=t.clientY);let r=s-a,l=o-n,d=l/i.height*15,c=-(15*(r/i.width));gsap.to(e,{rotationX:d,rotationY:c,duration:.3,ease:"power2.out",transformPerspective:1e3})}function L(t){if(isNaN(t)||t<0)return"00:00";let e=Math.floor(t/1e3),i=Math.floor(e/60).toString().padStart(2,"0"),a=(e%60).toString().padStart(2,"0");return`${i}:${a}`}function S(){document.querySelectorAll(".activity-progress-bar-fill").forEach(t=>{let e=parseInt(t.dataset.start,10),i=parseInt(t.dataset.end,10),a=Date.now();if(isNaN(e)||isNaN(i))return;let n=i-e,s=a-e,o=s/n*100;o=Math.max(0,Math.min(o,100)),t.style.width=`${o}%`;let r=t.closest(".activity-slide").querySelector(".time-info-text");r&&(r.textContent=`${L(s)} / ${L(n)}`)}),document.querySelectorAll(".elapsed-time-text").forEach(t=>{let e=parseInt(t.dataset.start,10);if(isNaN(e))return;let i=Date.now()-e;t.textContent=`${L(i)} elapsed`})}function B(t){let e=document.getElementById("activity-carousel-wrapper"),i=document.getElementById("discord-activity");if(!e||!i)return;gsap.killTweensOf(i),clearInterval(activityCarouselInterval),clearInterval(activityUpdateInterval);let a=[],n={spotify:"#1DB954",netflix:"#E50914",youtube:"#FF0000","visual studio code":"#007ACC"},s=t.discord_status||"offline",o="#747F8D";switch(s){case"online":o="#43B581";break;case"idle":o="#FAA61A";break;case"dnd":o="#F04747"}let r=`<div style="width: 10px; height: 10px; border-radius: 50%; background-color: ${o}; border: 2px solid rgba(255,255,255,0.2); flex-shrink: 0; box-shadow: 0 0 8px ${o};"></div>`;if(t.listening_to_spotify&&t.spotify){let l=t.spotify,d=l.timestamps?`<div class="activity-progress-content"><div class="activity-progress-bar-container"><div class="activity-progress-bar-fill" data-start="${l.timestamps.start}" data-end="${l.timestamps.end}"></div></div><p class="time-info-text"></p></div>`:"",c=`<p class="activity-title"><span style="font-weight: 400;">Listening to </span><span style="color: ${n.spotify}; font-weight: 700; text-shadow: 0 0 8px ${n.spotify};">Spotify</span></p>`;a.push(`<div class="activity-slide"><img src="${l.album_art_url}" alt="Album Art" style="width: 50px; height: 50px; border-radius: 8px; flex-shrink: 0;"><div class="activity-details-container">${c}<p class="activity-details">${l.song}</p><p class="activity-state">by ${l.artist}</p>${d}</div></div>`)}if(t.activities&&t.activities.length>0&&t.activities.filter(t=>"Spotify"!==t.name&&4!==t.type).forEach(t=>{let e=t.assets?.large_image?t.assets.large_image.startsWith("mp:external/")?`https://media.discordapp.net/external/${t.assets.large_image.substring(12)}`:`https://cdn.discordapp.com/app-assets/${t.application_id}/${t.assets.large_image}.png`:"",i=3===t.type?"Watching":2===t.type?"Listening to":"Playing",s=n[t.name.toLowerCase()]||"#8ea1e1",o=`<p class="activity-title"><span style="font-weight: 400;">${i} </span><span style="color: ${s}; font-weight: 700; text-shadow: 0 0 8px ${s};">${t.name}</span></p>`,l=`${o}${t.details?`<p class="activity-details">${t.details}</p>`:""}${t.state?`<p class="activity-state">${t.state}</p>`:""}`,d="";t.timestamps&&(t.timestamps.start&&t.timestamps.end?d=`<div class="activity-progress-content"><div class="activity-progress-bar-container"><div class="activity-progress-bar-fill" data-start="${t.timestamps.start}" data-end="${t.timestamps.end}"></div></div><p class="time-info-text"></p></div>`:t.timestamps.start&&(l+=`<p class="time-info-text elapsed-time-text" data-start="${t.timestamps.start}"></p>`)),a.push(`<div class="activity-slide">${r}${e?`<img src="${e}" alt="${t.name}" style="width: 45px; height: 45px; border-radius: 8px; flex-shrink: 0;">`:""}<div class="activity-details-container">${l}${d}</div></div>`)}),0===a.length){let $=s.charAt(0).toUpperCase()+s.slice(1);a.push(`<div class="activity-slide">${r}<div class="activity-details-container"><p class="activity-details">${$}</p><p class="activity-state">Not doing anything right now.</p></div></div>`)}gsap.to(i,{opacity:0,duration:.3,ease:"power1.in",onComplete(){e.innerHTML=a.join(""),S(),activityUpdateInterval=setInterval(S,1e3);let t=e.querySelectorAll(".activity-slide");if(t.length>1){let n=0;activityCarouselInterval=setInterval(()=>{n=(n+1)%t.length,e.style.transform=`translateX(-${100*n}%)`},5e3)}gsap.to(i,{opacity:1,duration:.4,ease:"power1.out"})}})}n.addEventListener("click",()=>{k=!k,I.muted=k,n.innerHTML=k?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path>':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>'}),s.addEventListener("input",()=>{I.volume=s.value,k=!1,I.muted=!1,n.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>'}),r.addEventListener("mousemove",t=>C(t,r)),r.addEventListener("touchmove",t=>{t.preventDefault(),C(t,r)}),r.addEventListener("mouseleave",()=>{gsap.to(r,{rotationX:0,rotationY:0,duration:.5,ease:"power2.out"})}),r.addEventListener("touchend",()=>{gsap.to(r,{rotationX:0,rotationY:0,duration:.5,ease:"power2.out"})}),l.addEventListener("mouseenter",()=>{o.style.opacity="1",setTimeout(()=>{o.style.opacity="0"},500)});let D;function M(){(D=new WebSocket("wss://api.lanyard.rest/websocket")).onopen=()=>{console.log("Connected to Lanyard WebSocket"),D.send(JSON.stringify({op:2,d:{subscribe_to_ids:[DISCORD_USER_ID]}})),wsHeartbeatInterval&&clearInterval(wsHeartbeatInterval),wsHeartbeatInterval=setInterval(()=>{1===D.readyState&&D.send(JSON.stringify({op:3}))},3e4)},D.onmessage=t=>{let{op:e,t:i,d:a}=JSON.parse(t.data);0===e&&("INIT_STATE"===i||"PRESENCE_UPDATE"===i)&&B(a)},D.onclose=()=>{wsHeartbeatInterval&&(clearInterval(wsHeartbeatInterval),wsHeartbeatInterval=null),console.warn("Lanyard WebSocket disconnected. Reconnecting in 5s..."),setTimeout(M,5e3)},D.onerror=t=>{console.error("Lanyard WebSocket error:",t),D.close()}}fetch(`https://api.lanyard.rest/v1/users/${DISCORD_USER_ID}`).then(t=>t.json()).then(t=>{t.success?B(t.data):document.getElementById("activity-carousel-wrapper").innerHTML='<div class="activity-slide"><p style="font-size: 14px; margin: 0; color: rgba(255, 255, 255, 0.7);">Discord: Data not available.</p></div>'}).catch(t=>{console.error("Error fetching initial Lanyard data:",t),document.getElementById("activity-carousel-wrapper").innerHTML='<div class="activity-slide"><p style="font-size: 14px; margin: 0; color: #F04747;">Failed to load activity.</p></div>'}),M()});
